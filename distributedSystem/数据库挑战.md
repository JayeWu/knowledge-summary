## 数据库减压的方式 ##
* 应用优化，查看 SQL 语句和相应索引是否能够改善，看看是否有不必要的压力给了数据库
* 引入缓存、加搜索引擎
* 拆分数据库，把数据库的数据和访问，分到多台数据库上
	* 垂直拆分：把同一个数据库中不同业务单元的数据分到不同数据库中
	* 水平拆分：把同一业务单元的数据拆分到多个数据库中

## 数据库垂直/水平拆分的困难 ##
### 垂直拆分 ###
* 单机的 ACID 保证被打破了。原来杂单机通过事务来进行的处理逻辑会受到很大的影响。选择是，放弃事务，修改实现，引入分布式事务。
* 一些 Join 操作会变得比较困难，因为数据可能已经在来个数据库中了，所以不能很方便地利用数据库自身的 Join，需要应用或其他方式解决
* 靠外键去进行约束的场景会受影响

### 水平拆分 ###
* 同样有 ACID 被破坏的可能
* 同样有 Join 操作的问题
* 靠外键进行约束的场景会受影响
* 依赖单库的自增序列生成唯一 ID 会受影响
* 针对单个逻辑意义的表查询要跨库

原来的一些存储过程、触发器等也需要修改。

## 事务处理 ##
### 分布式事务是什么 ###
分布式事务是指，事务的参与者、支持事务的服务器、资源服务器以及事务管理器，分别位于分布式系统的不同节点上。

### 分布式事务模型与规范 ###
* Application Program(AP)，即应用程序，可以理解为使用 DTP 模型的程序。它定义了事务的边界，并定义了构成该事务的应用程序的特定操作
* Resource Manager(RM)，资源管理器，可以理解为一个 DBMS 系统，或者消息服务器管理系统。AP 通过 RM 对资源进行控制，资源必须实现 XA 规范定义的接口。 RM 提供了存储共享资源的支持。
* Transaction Manager(TM)，事务管理器，负责协调和管理事务，提供给 AP 编程接口并管理 RM。

### DTP 模型 ###
* AP 与 RM 之间，可以使用 RM 提供的 native API 进行交互，不需要TM；当 AP 和 RM 之间需要进行分布式事务时，AP 需要得到对 RM 的连接，**此连接由 TM 管理**，然后使用 XA 的 native API 进行交互
* AP 与 TM 之间，使用 TX 接口，它用于对事务进行控制，包括启动事务、提交事务、回退事务
* TM 与 RM 之间通过 XA 接口进行交互。 TM 管理到　RM 的连接，并实现**两阶段提交**。 第一个阶段是**准备阶段**，第二个阶段是 **提交阶段**，只有当第一个阶段事务都成功时，第二阶段才进行统一提交，否则，统一回退

### 大型网站一致性的基础理论——CAP/BASE ###
#### CAP ####
* Consistency：一致性，所有的节点在同一时间读到同样的数据
* Availability：可用性，保证无论是成功还是失败，请求都能收到一个响应
* Parition-Tolerance：分区容忍性，在系统的一部分出现问题时，系统仍可以继续工作
* **选择 CA**：放弃分区容忍性，加强一致性和可用性。这是传统单机数据库的选择
* **选择 AP**：放弃一致性，追求分区容忍性和可用性。这是很多分布式系统在设计时的选择，如很多 NoSQL系统
* **选择 CP**：放弃可用性，网络问题会直接让整个系统不可用  

#### BASE ####
* Basically Available:基本可用，允许分区失败
* Soft state：软状态，接受一段时间的状态不同步
* Eventually consistent：最终一致性，保证最终数据的状态一致

### 比两阶段提交更轻量一些的Paxos协议 ###


