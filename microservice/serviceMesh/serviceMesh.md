## Service mesh ##
### 什么是 Service mesh ###
* Service mesh 又称“服务网格”，专注于服务间通信的基础设施层

### Service mesh 的特点 ###
* 应用程序间通讯的中间层
* 轻量级网络代理
* 应用程序无感知
* 解耦应用程序的重试/超时、监控、追踪和服务发现

### Service mesh 的作用 ###
* 可以将它比作是应用程序或者说微服务间的 TCP/IP，负责服务之间的网络调用、限流、熔断和监控
* 对于编写应用程序来说一般无须关心 TCP/IP 这一层（比如通过 HTTP 协议的 RESTful 应用）
* 同样使用 Service Mesh 也就无须关注服务之间的那些原来是通过应用程序或者其他框架实现的事情，比如 Spring Cloud、OSS，现在只要交给 Service Mesh 就可以了

### Service mesh 如何工作 ###
* Linkerd 将服务请求路由到目的地址，根据中的参数判断是到生产环境、测试环境还是 staging 环境中的服务（服务可能同时部署在这三个环境中），是路由到本地环境还是公有云环境？所有的这些路由信息可以动态配置，可以是全局配置也可以为某些服务单独配置
* 当 Linkerd 确认了目的地址后，将流量发送到相应服务发现端点，在 kubernetes 中是 service，然后 service 会将服务转发给后端的实例
* Linkerd 根据它观测到最近请求的延迟时间，选择出所有应用程序的实例中响应最快的实例
* Linkerd 将请求发送给该实例，同时记录响应类型和延迟数据
* 如果该实例挂了、不响应了或者进程不工作了，Linkerd 将把请求发送到其他实例上重试
* 如果该实例持续返回 error，Linkerd 会将该实例从负载均衡池中移除，稍后再周期性得重试
* 如果请求的截止时间已过，Linkerd 主动失败该请求，而不是再次尝试添加负载
* Linkerd 以 metric 和分布式追踪的形式捕获上述行为的各个方面，这些追踪信息将发送到集中 metric 系统

### 为什么使用 Service mesh ###
* Service mesh 并没有给我们带来新功能
* 它是用于解决其他工具已经解决过的问题
* 只不过这次是在 Cloud Native 的 kubernetes 环境下的实现
* 在 Cloud Native 架构下，容器的使用给予了异构应用程序的更多可行性
* kubernetes 增强的应用的横向扩容能力，用户可以快速的编排出复杂环境、复杂依赖关系的应用程序
* 同时开发者又无须过分关心应用程序的监控、扩展性、服务发现和分布式追踪这些繁琐的事情而专注于程序开发，赋予开发者更多的创造性




