## OceanBase ##

### 1 定义 ###
* 原生分布式关系型数据库
* 把所有与高可用及数据一致性相关的问题，在数据库内核层面解决了
* 一般互联网公司采用 中间层 + 单机数据库的分层设计
* 具备商业数据库最重要的特性：高度集成、整体交付、对业务无侵入
* 正真解决了分层设计中无法同时实现的水平扩展及跨库查询等缺陷

----------

### 2 特点 ###
* 高可用
* 强一致
* 易用性
* 高性能
* 易扩展
* 低成本

---
### 3 基础设计思想 ###
* 把每一份数据存放在三台不同的机器上
* 那么一台PC服务器出故障的概率是千分之一，那么三台为十亿分之一
* 关键是如何保证数据的强一致性

---
### 4 高可靠核心 PAXOS 协议 ###
* PAXOS 协议为分布式理论算法
* 本质是少数服从多数的协议

#### 4.1 具体实现 ####
* 在 n 个(n>=3)个数据库中，其中一个为主库，其余为备库
* 每笔事务不是同步到所有备库，而是同步到超过半数的库(包括主库自身)
	* 比如，3个中的2个，5个中的3个
* 一旦主库故障，只要存活的库超过半数，就可以自动选举出新的主库
* 并且恢复所有已提交的事务(超过半数库或者保证了每一笔提交的事务至少在一个库上存在)
* 这样就允许少数的库故障而不丢失数据、不中断业务

#### 4.2 优势 ####
* 基于 PAXOS 协议，OceanBase 能够实现单机/机房/城市级别，正真的无损容灾
* 在少数库故障时，RPO（恢复目标）为0，即没有数据损坏或丢失
* 基于完全自动的准备切换，能报 RTO(恢复时间)缩短到30秒内

#### 4.3 强一致性 ####
* 将事务消息改造为异步消息机制
* 事务开始时把消息投入消息系统
* 当事务中的交易全部完成后才通知消息系统投递消息
* 解决了高并发支撑同时的一致性问题

#### 4.4 事务 ####
* 是面向[OLTP][1]交易型关系数据库的一个关键流程
* 对于交易来说，数据库的事务必须是原子的

#### 4.5 高可用 ####
* 实现了[三地五中心容灾架构][2]在核心业务的落地
* 即一个城市的所有数据中心都完全不可用，整个系统在数据层面仍然会做到不丢失一行数据，并持续提供服务
* 例如，支付宝的会员ID采用了这个方案，即使其中一个城市故障，剩下的两个城市至少还有3 个活着的库，仍然能够自动选举出新的主库、立即恢复数据，并继续提供服务

#### 4.6 易用性 ####
* 许多操作和传统数据库一样，方便用户使用

#### 4.7 可扩展性 ####
* 每一个城市里的机房可以想象成一个可分片的大型数据库，可作为数据拆分的基础
	* 例如，吧全中国的所有用户分成一百份，那么一份放在第一个机房，依此类推使得整体伸缩能力可达到机房级
* 理论上只要增加机房，就能无限增加伸缩能力
* 不论跨越多少个机房、多少个城市，所有参与部署的数据库服务器在逻辑上是一个 OceanBase 集群的一部分
* 这就是所谓“原生”的概念，无论从应用视角还是运维视角，都是整体交付























[1]:h
[2]:h